"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[36],{91036:(e,t,n)=>{n.r(t),n.d(t,{default:()=>O});var r=n(95155),l=n(12115);function i(e,t){return Object.freeze({...e,...t})}let a=(0,l.createContext)(null);function s(){let e=(0,l.use)(a);if(null==e)throw Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return e}var o=n(98741),c=n.n(o);let u=(0,l.forwardRef)(function({bounds:e,boundsOptions:t,center:n,children:r,className:i,id:s,placeholder:c,style:u,whenReady:d,zoom:f,...x},m){let[p]=(0,l.useState)({className:i,id:s,style:u}),[h,g]=(0,l.useState)(null),v=(0,l.useRef)(void 0);(0,l.useImperativeHandle)(m,()=>h?.map??null,[h]);let b=(0,l.useCallback)(r=>{if(null!==r&&!v.current){let l=new o.Map(r,x);v.current=l,null!=n&&null!=f?l.setView(n,f):null!=e&&l.fitBounds(e,t),null!=d&&l.whenReady(d),g(Object.freeze({__version:1,map:l}))}},[]);(0,l.useEffect)(()=>()=>{h?.map.remove()},[h]);let y=h?l.createElement(a,{value:h},r):c??null;return l.createElement("div",{...p,ref:b},y)});var d=n(47650);function f(e){return(0,l.forwardRef)(function(t,n){let{instance:r,context:i}=e(t).current;(0,l.useImperativeHandle)(n,()=>r);let{children:s}=t;return null==s?null:l.createElement(a,{value:i},s)})}function x(e){return(0,l.forwardRef)(function(t,n){let{instance:r}=e(t).current;return(0,l.useImperativeHandle)(n,()=>r),null})}function m(e,t){let n=(0,l.useRef)(t);(0,l.useEffect)(function(){t!==n.current&&null!=e.attributionControl&&(null!=n.current&&e.attributionControl.removeAttribution(n.current),null!=t&&e.attributionControl.addAttribution(t)),n.current=t},[e,t])}function p(e,t){let n=(0,l.useRef)(void 0);(0,l.useEffect)(function(){return null!=t&&e.instance.on(t),n.current=t,function(){null!=n.current&&e.instance.off(n.current),n.current=null}},[e,t])}function h(e,t){let n=e.pane??t.pane;return n?{...e,pane:n}:e}function g(e,t,n){return Object.freeze({instance:e,context:t,container:n})}function v(e,t){return null==t?function(t,n){let r=(0,l.useRef)(void 0);return r.current||(r.current=e(t,n)),r}:function(n,r){let i=(0,l.useRef)(void 0);i.current||(i.current=e(n,r));let a=(0,l.useRef)(n),{instance:s}=i.current;return(0,l.useEffect)(function(){a.current!==n&&(t(s,n,a.current),a.current=n)},[s,n,t]),i}}function b(e,t){(0,l.useEffect)(function(){return(t.layerContainer??t.map).addLayer(e.instance),function(){t.layerContainer?.removeLayer(e.instance),t.map.removeLayer(e.instance)}},[t,e])}function y(e){return function(t){let n=s(),r=e(h(t,n),n);return m(n.map,t.attribution),p(r.current,t.eventHandlers),b(r.current,n),r}}let w=x(y(v(function({url:e,...t},n){return g(new o.TileLayer(e,h(t,n)),n)},function(e,t,n){!function(e,t,n){let{opacity:r,zIndex:l}=t;null!=r&&r!==n.opacity&&e.setOpacity(r),null!=l&&l!==n.zIndex&&e.setZIndex(l)}(e,t,n);let{url:r}=t;null!=r&&r!==n.url&&e.setUrl(r)}))),j=function(e){var t;return x((t=v(function(t,n){return g(e(t),n)}),function(e){let n=s(),r=t(e,n),{instance:i}=r.current,a=(0,l.useRef)(e.position),{position:o}=e;return(0,l.useEffect)(function(){return i.addTo(n.map),function(){i.remove()}},[n.map,i]),(0,l.useEffect)(function(){null!=o&&o!==a.current&&(i.setPosition(o),a.current=o)},[i,o]),r}))}(function(e){return new o.Control.Attribution(e)}),N=function(e,t){var n;return f((n=v(e,t),function(e){let t=s(),r=n(h(e,t),t);return p(r.current,e.eventHandlers),b(r.current,t),function(e,t){let n=(0,l.useRef)(void 0);(0,l.useEffect)(function(){if(t.pathOptions!==n.current){let r=t.pathOptions??{};e.instance.setStyle(r),n.current=r}},[e,t])}(r.current,e),r}))}(function({center:e,children:t,...n},r){let l=new o.CircleMarker(e,n);return g(l,i(r,{overlayContainer:l}))},function(e,t,n){t.center!==n.center&&e.setLatLng(t.center),null!=t.radius&&t.radius!==n.radius&&e.setRadius(t.radius)}),C=function(e,t){var n,r;return n=v(e),r=function(e,r){let l=s(),i=n(h(e,l),l);return m(l.map,e.attribution),p(i.current,e.eventHandlers),t(i.current,l,e,r),i},(0,l.forwardRef)(function(e,t){let[n,i]=(0,l.useState)(!1),{instance:a}=r(e,i).current;(0,l.useImperativeHandle)(t,()=>a),(0,l.useEffect)(function(){n&&a.update()},[a,n,e.children]);let s=a._contentNode;return s?(0,d.createPortal)(e.children,s):null})}(function(e,t){return g(new o.Popup(e,t.overlayContainer),t)},function(e,t,{position:n},r){(0,l.useEffect)(function(){let{instance:l}=e;function i(e){e.popup===l&&(l.update(),r(!0))}function a(e){e.popup===l&&r(!1)}return t.map.on({popupopen:i,popupclose:a}),null==t.overlayContainer?(null!=n&&l.setLatLng(n),l.openOn(t.map)):t.overlayContainer.bindPopup(l),function(){t.map.off({popupopen:i,popupclose:a}),t.overlayContainer?.unbindPopup(),t.map.removeLayer(l)}},[e,t,r,n])}),k=f(y(v(function({position:e,...t},n){let r=new o.Marker(e,t);return g(r,i(n,{overlayContainer:r}))},function(e,t,n){t.position!==n.position&&e.setLatLng(t.position),null!=t.icon&&t.icon!==n.icon&&e.setIcon(t.icon),null!=t.zIndexOffset&&t.zIndexOffset!==n.zIndexOffset&&e.setZIndexOffset(t.zIndexOffset),null!=t.opacity&&t.opacity!==n.opacity&&e.setOpacity(t.opacity),null!=e.dragging&&t.draggable!==n.draggable&&(!0===t.draggable?e.dragging.enable():e.dragging.disable())})));var L=n(5293),E=n(47290);let I=(e,t,n)=>new(c()).DivIcon({html:'\n      <div class="flex items-center justify-center">\n        <div class="beehive-marker '.concat(t,' flex flex-col items-center">\n          <div class="text-2xl">').concat(e,"</div>\n          ").concat(void 0!==n?'<div class="text-xs font-bold" style="margin-top: -3px;">#'.concat(n,"</div>"):"","\n        </div>\n      </div>\n    "),className:"",iconSize:[40,40],iconAnchor:[20,20]}),z=(e,t)=>"critical"===e.status?I("\uD83D\uDEA8","beehive-critical",t+1):"warning"===e.status?I("⚠️","beehive-warning",t+1):I("\uD83D\uDC1D","beehive-healthy",t+1);function M(){let e=s().map;return(0,r.jsx)("div",{className:"leaflet-top leaflet-right",style:{zIndex:1e3},children:(0,r.jsxs)("div",{className:"leaflet-control leaflet-bar",style:{background:"white",margin:"10px",boxShadow:"0 1px 5px rgba(0,0,0,0.4)",borderRadius:"4px"},children:[(0,r.jsx)("a",{href:"#",onClick:t=>{t.preventDefault(),e.zoomIn()},title:"Zoom in",style:{display:"block",width:"30px",height:"30px",lineHeight:"30px",textAlign:"center",textDecoration:"none",fontSize:"18px",fontWeight:"bold",borderBottom:"1px solid #ccc"},children:"➕"}),(0,r.jsx)("a",{href:"#",onClick:t=>{t.preventDefault(),e.zoomOut()},title:"Zoom out",style:{display:"block",width:"30px",height:"30px",lineHeight:"30px",textAlign:"center",textDecoration:"none",fontSize:"18px",fontWeight:"bold"},children:"➖"})]})})}function O(e){let{beehives:t,onSelectBeehive:n}=e,[i,a]=(0,l.useState)(!1),[s,o]=(0,l.useState)(null),[c,d]=(0,l.useState)([]),[f,x]=(0,l.useState)(!1);(0,l.useEffect)(()=>{a(!0)},[]),(0,l.useEffect)(()=>{let e=[];t.forEach(t=>{let{isCritical:n,criticalMessages:r}=(0,E.xt)(t,null);n&&e.push({hiveId:t.id,name:t.name,messages:r})}),d(e)},[t]);let m=(()=>{if(0===t.length)return[L.l.lat,L.l.lng];let e=t.reduce((e,t)=>e+t.coordinates.latitude,0),n=t.reduce((e,t)=>e+t.coordinates.longitude,0);return[e/t.length,n/t.length]})();if(!i)return(0,r.jsx)("div",{className:"rounded-xl overflow-hidden bg-gray-100 dark:bg-gray-800 flex items-center justify-center",style:{height:"400px",width:"100%"},children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-amber-500"})});let p=e=>{let t=parseInt(e.id.replace(/\D/g,""))||0,n=[2,3,5,7,11,13,17,19,23,29,31,37],r=n[t%n.length],l=n[(t+3)%n.length],i=137.5*t%360,a=8e-4+t%5*1e-4,s=Math.sin(Math.PI/180*i)*a+r/2e4,o=Math.cos(Math.PI/180*i)*a+l/2e4;return[L.l.lat+s,L.l.lng+o]},h=(()=>{if(0===t.length)return null;let e=t.filter(e=>"healthy"===e.status).length,n=t.filter(e=>"warning"===e.status).length,r=t.filter(e=>"critical"===e.status).length,l=t.reduce((e,t)=>e+t.metrics.temperature,0)/t.length,i=t.reduce((e,t)=>e+t.metrics.humidity,0)/t.length,a=t.reduce((e,t)=>e+t.metrics.weight,0)/t.length;return{healthyCount:e,warningCount:n,criticalCount:r,avgTemperature:l,avgHumidity:i,avgWeight:a,totalWeight:t.reduce((e,t)=>e+t.metrics.weight,0),averageVarroaMiteLevel:t.reduce((e,t)=>e+t.metrics.varroaMiteLevel,0)/t.length}})(),g=e=>{o(e),n(e)};return(0,r.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,r.jsx)("div",{className:"rounded-xl overflow-hidden border border-gray-200 dark:border-gray-700",style:{height:"450px",minHeight:"350px",width:"100%"},children:(0,r.jsxs)(u,{center:[m[0],m[1]],zoom:16,style:{height:"100%",width:"100%"},attributionControl:!1,zoomControl:!1,children:[(0,r.jsx)(w,{attribution:'\xa9 <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),(0,r.jsx)(M,{}),(0,r.jsx)(j,{position:"bottomright",prefix:"\uD83D\uDDFA️ "}),(0,r.jsx)(N,{center:[L.l.lat,L.l.lng],radius:20,pathOptions:{fillColor:"green",fillOpacity:.2,color:"green",weight:1},children:(0,r.jsx)(C,{children:(0,r.jsx)("div",{className:"p-1",children:(0,r.jsx)("div",{className:"text-sm font-semibold mb-1",children:"Cornell Botanical Gardens Apiary \uD83C\uDF3F"})})})}),t.map((e,t)=>{let n=p(e);return(0,r.jsx)(k,{position:n,icon:z(e,t),eventHandlers:{click:()=>g(e)},children:(0,r.jsx)(C,{children:(0,r.jsxs)("div",{className:"p-2",children:[(0,r.jsx)("h3",{className:"font-bold text-lg",children:e.name}),(0,r.jsxs)("p",{className:"text-sm text-gray-600",children:["Status: ",(0,r.jsx)("span",{className:"font-medium ".concat("healthy"===e.status?"text-green-600":"warning"===e.status?"text-yellow-600":"text-red-600"),children:e.status})]}),(0,r.jsxs)("div",{className:"mt-2 space-y-1",children:[(0,r.jsxs)("p",{className:"text-sm",children:["Temperature: ",e.metrics.temperature.toFixed(2),"\xb0C"]}),(0,r.jsxs)("p",{className:"text-sm",children:["Humidity: ",e.metrics.humidity.toFixed(2),"%"]}),(0,r.jsxs)("p",{className:"text-sm",children:["Weight: ",e.metrics.weight.toFixed(2)," kg"]}),(0,r.jsxs)("p",{className:"text-sm",children:["Activity: ",e.metrics.entranceActivity.toFixed(2),"/100"]})]}),e.alerts&&e.alerts.some(e=>!e.resolved)&&(0,r.jsx)("div",{className:"mt-2",children:(0,r.jsxs)("p",{className:"text-sm font-semibold text-red-600",children:[e.alerts.filter(e=>!e.resolved).length," Active Alert(s)"]})}),(0,r.jsx)("button",{onClick:()=>g(e),className:"mt-3 w-full px-3 py-1 bg-amber-500 hover:bg-amber-600 text-white text-sm rounded",children:"View Details"})]})})},e.id)})]})}),h&&(0,r.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 mb-4",children:[(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-3 md:p-4",children:[(0,r.jsx)("h3",{className:"text-md md:text-lg font-semibold text-gray-800 dark:text-white",children:"Temperature"}),(0,r.jsxs)("p",{className:"text-2xl md:text-3xl font-bold text-amber-500",children:[h.avgTemperature.toFixed(2),"\xb0C"]}),(0,r.jsx)("p",{className:"text-xs md:text-sm text-gray-500 dark:text-gray-400",children:"Apiary Average"})]}),(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-3 md:p-4",children:[(0,r.jsx)("h3",{className:"text-md md:text-lg font-semibold text-gray-800 dark:text-white",children:"Humidity"}),(0,r.jsxs)("p",{className:"text-2xl md:text-3xl font-bold text-blue-500",children:[h.avgHumidity.toFixed(2),"%"]}),(0,r.jsx)("p",{className:"text-xs md:text-sm text-gray-500 dark:text-gray-400",children:"Apiary Average"})]}),(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-3 md:p-4 sm:col-span-2 md:col-span-1",children:[(0,r.jsx)("h3",{className:"text-md md:text-lg font-semibold text-gray-800 dark:text-white",children:"Varroa Mite Detection"}),(0,r.jsxs)("p",{className:"text-2xl md:text-3xl font-bold ".concat(h.averageVarroaMiteLevel<2?"text-green-500":h.averageVarroaMiteLevel<3?"text-orange-500":"text-red-500"),children:[h.averageVarroaMiteLevel.toFixed(2),"%"]}),(0,r.jsx)("p",{className:"text-xs md:text-sm text-gray-500 dark:text-gray-400",children:h.averageVarroaMiteLevel<2?"Safe Level":h.averageVarroaMiteLevel<3?"Warning Level":"Critical Level"})]})]})]})}}}]);